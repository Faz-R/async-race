(()=>{"use strict";var t,e,n,a,s={11:(t,e,n)=>{var a=n(91),s=n.n(a),r=new URL(n(606),n.b);s()(r)},91:t=>{t.exports=function(t,e){return e||(e={}),t?(t=String(t.__esModule?t.default:t),e.hash&&(t+=e.hash),e.maybeNeedQuotes&&/[\t\n\f\r "'=<>`]/.test(t)?'"'.concat(t,'"'):t):t}},191:(t,e,n)=>{n.a(t,(async(t,a)=>{try{n.d(e,{Z:()=>l});var s=n(31),r=n(888),o=n(590),i=n(92),c=t([s,r,i]);[s,r,i]=c.then?(await c)():c;class d{static updateWinners(){var t;const e=window.location.hash.slice(1);null===(t=document.getElementById("winners"))||void 0===t||t.remove();const n=new r.Z,a=n.render();a.id="winners","garage"!==e&&""!==e||(a.style.display="none"),n.listen(a),d.container.append(a)}static renderPages(t){const e=new s.Z,n=e.render();n.id="garage",e.listen(n),d.container.append(n);const a=new r.Z,o=a.render();o.id="winners",a.listen(o),d.container.append(o),t?"garage"===t?document.getElementById("winners").style.display="none":document.getElementById("garage").style.display="none":o.style.display="none"}static hiddenPage(t){"garage"===t?(document.getElementById("winners").style.display="none",document.getElementById("garage").style.display="block"):(document.getElementById("winners").style.display="block",document.getElementById("garage").style.display="none")}constructor(){this.header=new o.Z("header","header")}run(){const t=window.location.hash.slice(1);d.container.append(this.header.render()),d.renderPages(t||"garage"),i.Z.enableRouteChange()}}d.container=document.body;const l=d;a()}catch(t){a(t)}}))},31:(t,e,n)=>{n.a(t,(async(t,a)=>{try{n.d(e,{Z:()=>b});var s=n(414),r=n(248),o=n(272),i=n(92),c=n(437),d=n(191),l=t([r,o,i,d]);[r,o,i,d]=l.then?(await l)():l;let u=!0,m=!0,g=!0;class h extends s.Z{render(){const t=h.TextObject.GarageTitle,e=Math.ceil(Number(r.Z.carsCount)/7);return r.Z.carsPage<e&&(m=!1),this.container.innerHTML=`\n    <div class='message-block' id='message'></div>\n    <form class="create-block block">\n      <input type='text' class='input create-text' name='form-text'>\n      <input type='color' class='input input-color create-color' name='form-color'>\n      <button class="button" id='create-button'>create</button>\n    </form>\n    <form class="update-block block" ${u?"disabled = 'true'":""}>\n      <input type='text' class='input' name='form-text' ${u?"disabled = 'true'":""}>\n      <input type='color' class='input input-color' name='form-color' ${u?"disabled = 'true'":""}>\n      <button class="button update-button" ${u?"disabled = 'true'":""}>update</button>\n    </form>\n    <div class="race-block block">\n      <button class="button race-button" id="race">race</button>\n      <button class="button reset-button" id="reset" disabled=true>reset</button>\n      <button class="button generate-button">generate cars</button>\n    </div>\n    <h1>${t} (${r.Z.carsCount})</h1>\n    <div class='pagination'>\n      <button class='page-prev button' ${g?"disabled = 'true'":""} id='prev-garage-page'>❮</button>\n      <div>Page: ${r.Z.carsPage}</div>\n      <button class='page-next button' ${m?"disabled = 'true'":""} id='next-garage-page'>❯</button>\n    </div>\n    ${i.Z.renderGarage()}\n    `,this.container}listen(t){let e;t.addEventListener("click",(async t=>{const n=t.target;if(n){if(n.closest(".remove-button")){const t=Number(n.id.replace("remove-car-",""));await(0,c.tD)(t),await(0,c.BS)(t),await(0,i.g)(),await i.Z.updateStateWinners(),d.Z.updateWinners(),this.render()}if(n.closest(".select-button")&&(e=Number(n.id.replace("select-car-","")),u=!1,this.render()),n.closest(".start-button")&&(e=Number(n.id.replace("start-engine-car-","")),await i.Z.startDriving(e)),n.closest(".stop-button")&&(e=Number(n.id.replace("stop-engine-car-","")),await i.Z.stopDriving(e)),n.closest(".page-next")){const t=Math.ceil(Number(r.Z.carsCount)/7);r.Z.carsPage<t&&(g=!1,r.Z.carsPage+=1,r.Z.carsPage===t&&(m=!0),await(0,i.g)(),this.render())}n.closest(".page-prev")&&r.Z.carsPage>1&&(m=!1,r.Z.carsPage-=1,1===r.Z.carsPage&&(g=!0),await(0,i.g)(),this.render())}if(n){if(n.closest(".generate-button")){const t=(0,o.cj)();m=!1,t.forEach((async t=>{await(0,c.DT)(t),await(0,i.g)(),this.render()}))}if(n.closest(".race-button")){n.disabled=!0,(0,o.Ro)(Array.from(document.querySelectorAll(".remove-button"))),(0,o.Ro)(Array.from(document.querySelectorAll(".select-button"))),(0,o.Ro)(Array.from(document.querySelectorAll(".start-button"))),document.querySelector(".page-prev").disabled=!0,document.querySelector(".page-next").disabled=!0;const t=await(0,o.S3)(i.Z.startDriving,!0);await(0,c.AV)(t),await i.Z.updateStateWinners(),d.Z.updateWinners();const e=document.getElementById("message");e&&(e.innerHTML=`${t.name} went first ${t.time}s!`,e.classList.toggle("visible",!0)),(0,o.Ro)(Array.from(document.querySelectorAll(".remove-button"))),(0,o.Ro)(Array.from(document.querySelectorAll(".select-button"))),(0,o.Ro)(Array.from(document.querySelectorAll(".start-button"))),(0,o.Ro)(Array.from(document.querySelectorAll(".stop-button"))),document.querySelector(".page-prev").disabled=!1,document.querySelector(".page-next").disabled=!1,document.getElementById("reset").disabled=!1}if(n.closest(".reset-button")){n.disabled=!0,r.Z.cars.map((({id:t})=>i.Z.stopDriving(t)));const t=document.getElementById("message");null==t||t.classList.toggle("visible",!1),document.getElementById("race").disabled=!1}}})),t.addEventListener("submit",(async t=>{t.preventDefault();const n=null==t?void 0:t.target,a=new FormData(n);let s=a.get("form-text"),r=a.get("form-color");s||(s=""),r||(r="#000000");const o={name:s,color:r};t.target.closest(".create-block")&&await(0,c.DT)(o),t.target.closest(".update-block")&&(await(0,c.Bo)(e,o),u=!0),await(0,i.g)(),this.render()}))}}h.TextObject={GarageTitle:"Garage"};const b=h;a()}catch(t){a(t)}}))},590:(t,e,n)=>{n.d(e,{Z:()=>o});class a{constructor(t,e){this.container=document.createElement(t),this.container.className=e}render(){return this.container}}var s;!function(t){t.GaragePage="garage",t.WinnersPage="winners"}(s||(s={}));const r=[{id:s.GaragePage,text:"Garage"},{id:s.WinnersPage,text:"Winners"}],o=class extends a{renderPageButtons(){const t=document.createElement("div");t.className="header-buttons",r.forEach((e=>{const n=document.createElement("a");n.href=`#${e.id}`,n.innerText=e.text,n.className="header-button button",t.append(n)})),this.container.append(t)}render(){return this.renderPageButtons(),this.container}}},888:(t,e,n)=>{n.a(t,(async(t,a)=>{try{n.d(e,{Z:()=>l});var s=n(414),r=n(248),o=n(92),i=n(272),c=t([r,o,i]);[r,o,i]=c.then?(await c)():c;class d extends s.Z{constructor(){super(...arguments),this.nextPage=!1,this.prevPage=!0,this.maxPages=Math.ceil(Number(r.Z.winnersCount)/10)}render(){r.Z.winnersPage>=this.maxPages&&(this.nextPage=!0);const t=d.TextObject.WinnersTitle;return this.container.innerHTML=`\n    <h1>${t} (${r.Z.winnersCount})</h1>\n    <div class='pagination'>\n      <button class='winners-page-prev button' ${this.prevPage?"disabled = 'true'":""} id='winners-prev'>❮</button>\n      <div>Page: ${r.Z.winnersPage}</div>\n      <button class='winners-page-next button' ${this.nextPage?"disabled = 'true'":""} id='winners-next'>❯</button>\n    </div>\n    <table class='table'>\n      <tr class='table-row head-row'>\n        <th class='table-col-head' id='sort-by-id'>№</th>\n        <th class='table-col-head'>Car</th>\n        <th class='table-col-head'>Name</th>\n        <th class='table-col-head col-wins' id='sort-by-wins'>\n          Wins \n          ${(0,i.r$)("wins")}\n        </th>\n        <th class='table-col-head col-time' id='sort-by-time'>\n          Best time(s) \n          ${(0,i.r$)("time")}\n        </th>\n      </tr>\n      <tbody>\n      ${r.Z.winners.map(((t,e)=>`<tr class='table-row'>\n        <td class='table-col'>${e+1+10*(r.Z.winnersPage-1)}</td>\n        <td class='table-col col-img'>${o.Z.renderCarImage(t.car.color)}</td>\n        <td class='table-col'>${t.car.name}</td>\n        <td class='table-col'>${t.wins}</td>\n        <td class='table-col'>${t.time}</td>\n      </tr>`)).join("")}\n      </tbody>\n    </table>\n    `,this.container}listen(t){t.addEventListener("click",(async t=>{const e=t.target;e.closest(".winners-page-next")&&r.Z.winnersPage<this.maxPages&&(this.prevPage=!1,r.Z.winnersPage+=1,r.Z.winnersPage===this.maxPages&&(this.nextPage=!0),await o.Z.updateStateWinners(),this.render()),e.closest(".winners-page-prev")&&r.Z.winnersPage>1&&(this.nextPage=!1,r.Z.winnersPage-=1,1===r.Z.winnersPage&&(this.prevPage=!0),await o.Z.updateStateWinners(),this.render()),"sort-by-wins"===e.id&&(r.Z.sortBy="wins",r.Z.sortOrder="DESC"===r.Z.sortOrder?"ASC":"DESC",await o.Z.updateStateWinners(),this.render()),"sort-by-time"===e.id&&(r.Z.sortBy="time",r.Z.sortOrder="DESC"===r.Z.sortOrder?"ASC":"DESC",await o.Z.updateStateWinners(),this.render())}))}}d.TextObject={WinnersTitle:"Winners"};const l=d;a()}catch(t){a(t)}}))},414:(t,e,n)=>{n.d(e,{Z:()=>s});class a{constructor(){this.container=document.createElement("div")}render(){return this.container}}a.TextObject={};const s=a},253:(t,e,n)=>{n.a(t,(async(t,e)=>{try{n(11);var a=n(191),s=t([a]);(new((a=(s.then?(await s)():s)[0]).Z)).run(),e()}catch(t){e(t)}}))},92:(t,e,n)=>{n.a(t,(async(t,a)=>{try{n.d(e,{Z:()=>g,g:()=>u});var s=n(191),r=n(437),o=n(248),i=n(272),c=t([s,o,i]);[s,o,i]=c.then?(await c)():c;const d=t=>`\n<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" width="70"><path fill="${t}" d="M107 74c-28 0-73 5-73 5s6 1 5 4-13 17-16 19c-2 2-5 2-8 2l-2 4c-5 8-4 17-4 16v1c-7 4-8 6-9 7l1 21c1 2 8 6 12 8a27 27 0 0 1 8-21 27 27 0 0 1 46 19l-1 7h121a27 27 0 1 1 52-1c5 0 14-2 15-4 1-3 3-17 1-25-2-7-13-21-52-29-44-25-63-31-89-33h-7zm2 4c6 0 31 1 56 14 9 5 33 17 30 19-13 11-22-3-86-5l-2-28h2zm-14 0h4l-1 28-55-3c-2-2 8-16 20-21 10-3 25-4 32-4zm126 37h3c2 1 11 4 17 8l9 9c-7 2-32-14-31-16l2-1zm-25 7h10l-3 2h-4l-3-2zm17 13a23 23 0 1 0 0 46 23 23 0 0 0 0-46zm-173 1a23 23 0 1 0 0 46 23 23 0 0 0 0-46zm173 9c3 0 7 2 9 4s4 6 4 9-2 7-4 9-6 4-9 4-7-2-9-4-4-6-4-9 2-7 4-9 6-4 9-4zm-173 1c3 0 6 2 9 4 2 2 3 6 3 9s-1 7-3 9c-3 2-6 4-9 4-4 0-7-2-9-4-3-2-4-6-4-9s1-7 4-9c2-2 5-4 9-4z"/></svg>\n`,l=({id:t,name:e,color:n,isEngineStarted:a})=>`\n<div class='car-block'>\n  <div class='car-settings'>\n    <button class="button select-button fa-solid fa-check" id="select-car-${t}">Select</button>\n    <button class="button remove-button" id="remove-car-${t}">Delete</button>\n    <button class="button start-button" id="start-engine-car-${t}" ${a?"disabled":""}>Start</button>\n    <button class="button stop-button" id="stop-engine-car-${t}" ${a?"":"disabled"}>Stop</button>\n    <span class='car-name'>${e}</span>\n  </div>\n  <div class='road'>\n    <div class='car' id='car-${t}'>\n      ${d(n)}\n    </div>\n    <div class='flag' id='flag-${t}'>🏁</div>\n  </div> \n</div>\n`,u=async()=>{const{items:t,count:e}=await(0,r.Rn)(o.Z.carsPage);o.Z.cars=t,o.Z.carsCount=e};function m(){window.addEventListener("hashchange",(()=>{const t=window.location.hash.slice(1);s.Z.hiddenPage(t)}))}const g={renderGarage:()=>`\n  <ul class='garage-list'>\n    ${o.Z.cars.map((t=>`\n    <li>${l(t)}</li>\n    `)).join("")}\n  </ul>\n`,startDriving:async(t,e)=>{const n=document.getElementById(`start-engine-car-${t}`);n instanceof HTMLButtonElement&&(n.disabled=!0);const{velocity:a,distance:s}=await(0,r.p6)(t),c=Math.round(s/a);n instanceof HTMLButtonElement&&(n.disabled=!0),e&&(document.getElementById(`stop-engine-car-${t}`).disabled=!0);const d=document.getElementById(`car-${t}`),l=document.getElementById(`flag-${t}`),u=Math.floor((0,i.hG)(d,l))+70;o.Z.animation[t]=(0,i.oQ)(d,u,c);const{success:m}=await(0,r.Ag)(t);return m||window.cancelAnimationFrame(o.Z.animation[t].id),{success:m,id:t,time:c}},stopDriving:async t=>{const e=document.getElementById(`stop-engine-car-${t}`);e instanceof HTMLButtonElement&&(e.disabled=!0),await(0,r.yQ)(t),document.getElementById(`start-engine-car-${t}`).disabled=!1;const n=document.getElementById(`car-${t}`);n&&(n.style.transform="translateX(0)"),o.Z.animation[t]&&window.cancelAnimationFrame(o.Z.animation[t].id)},renderCarImage:d,updateStateWinners:async()=>{const{items:t,count:e}=await(0,r.ix)({page:o.Z.winnersPage,sort:o.Z.sortBy,order:o.Z.sortOrder});o.Z.winners=t,o.Z.winnersCount=e},enableRouteChange:m};a()}catch(h){a(h)}}))},437:(t,e,n)=>{n.d(e,{AV:()=>w,Ag:()=>h,BS:()=>p,Bo:()=>u,DT:()=>d,Rn:()=>i,ix:()=>b,p6:()=>m,tD:()=>l,yQ:()=>g});const a="http://localhost:3000",s=`${a}/garage`,r=`${a}/engine`,o=`${a}/winners`;async function i(t,e=7){const n=await fetch(`${s}?_page=${t}&_limit=${e}`);return{items:await n.json(),count:n.headers.get("X-Total-count")}}const c=async t=>(await fetch(`${s}/${t}`)).json(),d=async t=>(await fetch(s,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})).json(),l=async t=>(await fetch(`${s}/${t}`,{method:"DELETE"})).json(),u=async(t,e)=>(await fetch(`${s}/${t}`,{method:"PUT",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})).json(),m=async t=>(await fetch(`${r}?id=${t}&status=started`,{method:"PATCH"})).json(),g=async t=>(await fetch(`${r}?id=${t}&status=stopped`,{method:"PATCH"})).json(),h=async t=>{const e=await fetch(`${r}?id=${t}&status=drive`,{method:"PATCH"}).catch();return 200!==e.status?{success:!1}:Object.assign({},await e.json())},b=async({page:t,limit:e=10,sort:n,order:a})=>{const s=await fetch(`${o}?_page=${t}&_limit=${e}${((t,e)=>t&&e?`&_sort=${t}&_order=${e}`:"")(n,a)}`),r=await s.json();return{items:await Promise.all(r.map((async t=>Object.assign(Object.assign({},t),{car:await c(t.id)})))),count:s.headers.get("X-Total-count")}},p=async t=>(await fetch(`${o}/${t}`,{method:"DELETE"})).json(),w=async({id:t,time:e})=>{const n=await(async t=>(await fetch(`${o}/${t}`)).status)(t);if(404===n)await(async t=>(await fetch(`${o}`,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})).json())({id:t,wins:1,time:e});else{const n=await(async t=>(await fetch(`${o}/${t}`)).json())(t);await(async(t,e)=>(await fetch(`${o}/${t}`,{method:"PUT",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})).json())(t,{id:t,wins:n.wins+1,time:e<n.time?e:n.time})}}},248:(t,e,n)=>{n.a(t,(async(t,a)=>{try{n.d(e,{Z:()=>c});var s=n(437);const{items:t,count:r}=await(0,s.Rn)(1),{items:o,count:i}=await(0,s.ix)({page:1,limit:10,sort:null,order:null}),c={carsPage:1,cars:t,carsCount:r,animation:{},winnersPage:1,winners:o,winnersCount:i,sortBy:"id",sortOrder:"DESC",view:"garage"};a()}catch(t){a(t)}}),1)},272:(t,e,n)=>{n.a(t,(async(t,a)=>{try{n.d(e,{Ro:()=>w,S3:()=>b,cj:()=>g,hG:()=>i,oQ:()=>c,r$:()=>p});var s=n(248),r=t([s]);function o(t){const{top:e,left:n,width:a,height:s}=t.getBoundingClientRect();return{x:n+a/2,y:e+s/2}}function i(t,e){const n=o(t),a=o(e);return Math.hypot(n.x-a.x,n.y-a.y)}function c(t,e,n){let a=0;const s={};return s.id=window.requestAnimationFrame((function r(o){a||(a=o);const i=o-a,c=Math.round(i*(e/n));t.style.transform=`translateX(${Math.min(c,e)}px)`,c<e&&(s.id=window.requestAnimationFrame(r))})),s}s=(r.then?(await r)():r)[0];const d=["Audi","BMW","Ford","Honda","Hyundai","Kia","Lada","Mazda","Toyota","Subaru"],l=["A6","Cabriolet","Sport","TT","Caprice","Daster","Matiz","Tornado","Volt","EV8"],u=()=>`${d[Math.floor(Math.random()*d.length)]} ${l[Math.floor(Math.random()*d.length)]}`,m=()=>{let t="#";for(let e=0;e<6;e+=1)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t},g=(t=100)=>new Array(t).fill(1).map((()=>({name:u(),color:m()}))),h=async(t,e)=>{const{success:n,id:a,time:r}=await Promise.race(t);if(!n){const n=e.findIndex((t=>t===a)),s=[...t.slice(0,n),...t.slice(n+1,t.length)],r=[...e.slice(0,n),...e.slice(n+1,e.length)];return h(s,r)}return Object.assign(Object.assign({},s.Z.cars.find((t=>t.id===a))),{time:+(r/1e3).toFixed(2)})},b=async(t,e)=>{const n=s.Z.cars.map((({id:n})=>t(n,e)));return await h(n,s.Z.cars.map((t=>t.id)))};function p(t){return s.Z.sortBy===t?"DESC"===s.Z.sortOrder?"▼":"▲":""}function w(t){return t.forEach((t=>{const e=t;return!0===e.disabled?e.disabled=!1:e.disabled=!0,e})),t}a()}catch(y){a(y)}}))},606:(t,e,n)=>{t.exports=n.p+"assets/favicon.ico"}},r={};function o(t){var e=r[t];if(void 0!==e)return e.exports;var n=r[t]={exports:{}};return s[t](n,n.exports,o),n.exports}o.m=s,t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",n="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",a=t=>{t&&!t.d&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},o.a=(s,r,o)=>{var i;o&&((i=[]).d=1);var c,d,l,u=new Set,m=s.exports,g=new Promise(((t,e)=>{l=e,d=t}));g[e]=m,g[t]=t=>(i&&t(i),u.forEach(t),g.catch((t=>{}))),s.exports=g,r((s=>{var r;c=(s=>s.map((s=>{if(null!==s&&"object"==typeof s){if(s[t])return s;if(s.then){var r=[];r.d=0,s.then((t=>{o[e]=t,a(r)}),(t=>{o[n]=t,a(r)}));var o={};return o[t]=t=>t(r),o}}var i={};return i[t]=t=>{},i[e]=s,i})))(s);var o=()=>c.map((t=>{if(t[n])throw t[n];return t[e]})),d=new Promise((e=>{(r=()=>e(o)).r=0;var n=t=>t!==i&&!u.has(t)&&(u.add(t),t&&!t.d&&(r.r++,t.push(r)));c.map((e=>e[t](n)))}));return r.r?d:o()}),(t=>(t?l(g[n]=t):d(m),a(i)))),i&&(i.d=0)},o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;o.g.importScripts&&(t=o.g.location+"");var e=o.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");n.length&&(t=n[n.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=t})(),o.b=document.baseURI||self.location.href,o(253)})();
//# sourceMappingURL=main.js.map